<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <script src="https://unpkg.com/htmx.org"></script>
</head>
<body>
  <h1>My Daily Cards</h1>

  <!-- Секция паков -->
  <div>
    <h2>Паки</h2>
    <!-- при загрузке подгружаем packs.html -->
    <div id="packs-container"
         hx-get="/api/packs/html"
         hx-trigger="load"
         hx-swap="innerHTML">
      <!-- сюда придёт <ul>…</ul> -->
    </div>

    <!-- Форма создания пака, добавляем `<li>` в конец списка -->
    <form hx-post="/api/packs/html"
          hx-target="#packs-container ul"
          hx-swap="beforeend">
      <input name="name" placeholder="Новый пак" required>
      <button type="submit">Создать пак</button>
    </form>
  </div>

  <!-- Секция карточек выбранного пака -->
  <div id="cards-section" style="display:none;">
    <h2>Карточки</h2>
    <div id="cards-container"></div>

    <form id="card-form">
      <input name="question" placeholder="Вопрос" required>
      <input name="answer"   placeholder="Ответ" required>
      <button type="submit">Добавить карточку</button>
    </form>
  </div>

  <script>
    // Как только рисуется список паков, вешаем клики
    document.body.addEventListener('htmx:afterSwap', evt => {
      if (evt.detail.target.id === 'packs-container') {
        document.querySelectorAll('#packs-container li').forEach(li => {
          li.onclick = () => {
            const id = li.dataset.id;
            // показать секцию карточек
            document.getElementById('cards-section').style.display = 'block';
            // подгрузить cards.html
            htmx.ajax('GET', `/api/packs/${id}/cards/html`, {
              target: '#cards-container',
              swap: 'innerHTML'
            });
            // настроить форму добавления карточки
            const form = document.getElementById('card-form');
            form.setAttribute('hx-post', `/api/packs/${id}/cards/html`);
            form.setAttribute('hx-target', '#cards-container ul');
            form.setAttribute('hx-swap', 'beforeend');
          };
        });
      }
    });
  </script>
</body>
</html>
